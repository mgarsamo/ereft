# Ereft - Ethiopian Real Estate Mobile App
# .cursorrules - Development Guidelines and Project Context

## ğŸ—ï¸ PROJECT ARCHITECTURE

### Backend (Django REST Framework)
- **Framework**: Django >=5.1 + Django REST Framework 3.14+
- **Runtime**: Python 3.11 (Render)
- **Deployment**: Render (Python 3.11)
- **Database**: PostgreSQL via DATABASE_URL environment variable (production), SQLite (development)
- **Authentication**: JWT via djangorestframework-simplejwt
- **File Storage**: Cloudinary for image uploads (manual integration, no django-cloudinary-storage)
- **CORS**: Configured for web/admin tools only (not required for native app)

### Mobile App (React Native + Expo)
- **Framework**: React Native with Expo SDK
- **Navigation**: React Navigation
- **State Management**: React Context API
- **Maps**: react-native-maps with Google Maps API
- **Authentication**: Google OAuth + SMS verification
- **Deep Linking**: Custom scheme 'ereft://oauth'

## ğŸ” AUTHENTICATION SYSTEM

### JWT Authentication
- **All protected endpoints require**: `Authorization: Bearer <JWT>`
- **Google OAuth & SMS flows must issue JWT on success**
- **Use djangorestframework-simplejwt for JWT implementation**

### Google OAuth Flow
- **Client IDs**: 
  - iOS: 91486871350-ic7gbroh747pe9u31gqe1jjlhncuiua44.apps.googleusercontent.com
  - Web: 91486871350-79fvub6490473eofjpu1jjlhncuiua44.apps.googleusercontent.com
- **Server redirect (Google â†’ backend)**: HTTPS only (https://ereft.onrender.com/oauth)
- **App re-entry**: Custom deep link `ereft://oauth` is allowed and required for mobile
- **Flow**: Mobile app â†’ Google OAuth â†’ Backend processes code â†’ Returns JWT + user data

### SMS Verification
- **Provider**: Twilio (configured in backend)
- **Flow**: Phone number input â†’ SMS sent â†’ Code verification â†’ Account creation/login with JWT

## ğŸ—ºï¸ MAPS & GEOCODING

### Google Maps Integration
- **API Key**: AIzaSyAWis-jNmUwxCikA2FG7QqLi-nz7jEvadY (from Render environment)
- **Service**: GeocodingService.js for address-to-coordinate conversion
- **Fallback System**: Ethiopian city coordinates when Google can't find exact address
- **Map Display**: react-native-maps with property markers and clustering

## ğŸ  PROPERTY LISTING SYSTEM

### Data Models
- **Property**: Core property information (title, description, price, location, features)
- **PropertyImage**: Multiple images per property with Cloudinary URLs
- **UserProfile**: Extended user information (phone, profile picture, agent status)
- **Neighborhood**: Geographic areas for property categorization
- **Favorite**: User-saved properties

### Cloudinary & Images
- **Option B selected**: FileField + manual Cloudinary upload (no django-cloudinary-storage, Avoid Pillow unless switching to ImageField)
- **Store only Cloudinary secure_url in DB**: No image processing on server

## ğŸ“± MOBILE APP STRUCTURE

### Core Screens
- **HomeScreen**: Featured properties, market stats, quick actions
- **MapScreen**: Interactive map with property markers
- **PropertyDetailScreen**: Detailed property information and images
- **AddPropertyScreen**: Create/edit property listings with image upload
- **LoginScreen**: Authentication options (Google, SMS, username/password)
- **ProfileScreen**: User account management

## ğŸ”§ TECHNICAL REQUIREMENTS

### API Response Contracts (Non-Breaking)
- **/api/properties/**: `{id:int; title:str; price:number; location:str; images:[str]; features:obj; created_at:iso8601}`
- **/api/properties/featured/**: `[{id:int; title:str; price:number; image:str}]`
- **/api/properties/stats/**: `{count:int; avg_price:number; by_type:[{type:str; count:int}]}`
- **/api/favorites/**: `{results:[{property_id:int; saved_at:iso8601}], count:int}`
- **Do not change field names without updating serializer + mobile uses in same change**

### Endpoint Guarantee
- **If an endpoint above does not exist and is not marked as "planned," create it (views, urls, serializer) before returning 404. For planned endpoints, do not fabricate logicâ€”instead, return a placeholder 501 Not Implemented response with a note indicating it's upcoming.**

### Backend API Endpoints
- **Properties**: `/api/properties/` (CRUD operations)
- **Featured**: `/api/properties/featured/` (featured properties) **[planned]**
- **Stats**: `/api/properties/stats/` (market statistics) **[planned]**
- **Search**: `/api/properties/search/` (advanced property search)
- **Favorites**: `/api/favorites/` (user saved properties)
- **Authentication**: `/api/auth/*` (login, register, OAuth, JWT verification)

## ğŸš« CRITICAL RESTRICTIONS

### Google OAuth Limitations

- **HTTPS Only for Server Redirects**: Must use `https://ereft.onrender.com/oauth` for production
- **Custom Deep Links Allowed**: `ereft://oauth` is allowed and required for mobile app re-entry

### Hardcoding Restrictions
- **No Hardcoded Values**: All configuration must use environment variables
- **No Development Shortcuts**: Production-ready code only
- **No Mock Data**: Use real backend APIs and database

### Build Dependencies
- **Avoid Pillow**: Causes build failures on Render (Python 3.11 compatibility)
- **No django-cloudinary-storage**: Use manual Cloudinary integration instead
- **Minimal Dependencies**: Only essential packages for production

## ğŸ¯ DEVELOPMENT PRINCIPLES

### Production-First Approach
- **No __DEV__ Flags**: All code must work in production
- **Error Handling**: Comprehensive error handling and user feedback
- **Performance**: Optimize for mobile devices and network conditions
- **Security**: Proper JWT authentication, validation, and data sanitization

### User Experience
- **Seamless Authentication**: Google OAuth should work like signup/login
- **Offline Support**: Graceful degradation when backend unavailable
- **Loading States**: Clear feedback during API calls and operations
- **Error Recovery**: Help users recover from errors gracefully

### Testing Approach
- **API Testing**: Use curl commands to verify backend endpoints
- **Mobile Testing**: Test on physical devices, not just simulators
- **OAuth Testing**: Verify complete flow from Google to app login
- **Database Testing**: Ensure sample data and real data work correctly

## ğŸš¨ CRITICAL REMINDERS

### Database Safety
- **Never delete production data** without explicit permission
- **Always backup** before major changes
- **Test migrations** on local database first
- **Use populate_sample_data** command for testing

### API Consistency
- **Maintain backward compatibility** when possible
- **Version APIs** if breaking changes are necessary
- **Document all endpoints** with examples
- **Handle errors gracefully** with meaningful messages

### Mobile App Safety
- **Test on real devices** before deployment
- **Verify deep linking** works correctly
- **Check offline behavior** and error states
- **Ensure OAuth flows** complete successfully

## ğŸ› ï¸ CODE CHANGE PROCESS

### When Adding New Features:
- **Backend-Frontend Sync**: Update both backend (Django) and frontend (React Native) code to keep APIs in sync
- **Endpoint Verification**: Always check existing endpoints and models before creating new ones
- **URL Configuration**: Include necessary imports and update `urls.py` when adding backend routes
- **Serializer Updates**: Write or update DRF serializers when model data changes
- **Context Integration**: On the frontend, update context providers to handle new API responses
- **Naming Consistency**: Maintain consistent naming between backend fields and frontend props

### When Editing Existing Code:
- **Feature Preservation**: Preserve all existing features unless explicitly told to remove them
- **Environment Variables**: Keep environment variable usage intact â€” no hardcoding
- **Pattern Consistency**: Maintain logging and error handling patterns already present in the file

## ğŸš« DEPLOYMENT SAFETY

- **Production Builds**: Do not commit changes that break production builds
- **Database Migrations**: All migrations must run without errors on PostgreSQL
- **Environment Variables**: Do not modify Render environment variables inside code

## ğŸ“ COMPLETE FOLDER STRUCTURE

```
Ereft/
â”œâ”€â”€ .cursorrules                          # Development guidelines and project context
â”œâ”€â”€ README.md                             # Project documentation
â”œâ”€â”€ ereft_api/                            # Django Backend
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py                         # Environment configuration
â”‚   â”œâ”€â”€ settings.py                       # Django settings
â”‚   â”œâ”€â”€ urls.py                          # Root URL configuration
â”‚   â”œâ”€â”€ wsgi.py                          # WSGI application
â”‚   â”œâ”€â”€ manage.py                         # Django management script
â”‚   â”œâ”€â”€ requirements.txt                  # Python dependencies
â”‚   â”œâ”€â”€ listings/                         # Main app for property listings
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ admin.py                      # Django admin configuration
â”‚   â”‚   â”œâ”€â”€ apps.py                       # App configuration
â”‚   â”‚   â”œâ”€â”€ models.py                     # Data models (Property, PropertyImage, UserProfile, etc.)
â”‚   â”‚   â”œâ”€â”€ serializers.py                # DRF serializers
â”‚   â”‚   â”œâ”€â”€ urls.py                       # App URL routing
â”‚   â”‚   â”œâ”€â”€ views.py                      # API views and endpoints
â”‚   â”‚   â”œâ”€â”€ utils.py                      # Utility functions (Cloudinary, geocoding)
â”‚   â”‚   â”œâ”€â”€ migrations/                   # Database migrations
â”‚   â”‚   â””â”€â”€ management/                   # Django management commands
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ commands/
â”‚   â”‚           â”œâ”€â”€ __init__.py
â”‚   â”‚           â””â”€â”€ populate_sample_data.py # Sample data population
â”‚   â”œâ”€â”€ static/                           # Static files
â”‚   â”œâ”€â”€ media/                            # Media uploads (development)
â”‚   â””â”€â”€ templates/                        # HTML templates
â”œâ”€â”€ ereft_mobile/                         # React Native Mobile App
â”‚   â”œâ”€â”€ app.json                          # Expo configuration
â”‚   â”œâ”€â”€ package.json                      # Node.js dependencies
â”‚   â”œâ”€â”€ babel.config.js                   # Babel configuration
â”‚   â”œâ”€â”€ metro.config.js                   # Metro bundler configuration
â”‚   â”œâ”€â”€ App.js                            # Main app component
â”‚   â”œâ”€â”€ src/                              # Source code
â”‚   â”‚   â”œâ”€â”€ components/                   # Reusable UI components
â”‚   â”‚   â”‚   â”œâ”€â”€ GoogleSignIn.js           # Google OAuth component
â”‚   â”‚   â”‚   â”œâ”€â”€ PropertyCard.js           # Property display card
â”‚   â”‚   â”‚   â”œâ”€â”€ ImageGallery.js           # Property image gallery
â”‚   â”‚   â”‚   â”œâ”€â”€ SearchBar.js              # Property search component
â”‚   â”‚   â”‚   â””â”€â”€ LoadingSpinner.js         # Loading indicator
â”‚   â”‚   â”œâ”€â”€ context/                      # React Context providers
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthContext.js            # Authentication state management
â”‚   â”‚   â”‚   â”œâ”€â”€ PropertyContext.js        # Property data management
â”‚   â”‚   â”‚   â””â”€â”€ UserStorage.js            # Local storage and demo users
â”‚   â”‚   â”œâ”€â”€ screens/                      # App screens
â”‚   â”‚   â”‚   â”œâ”€â”€ HomeScreen.js             # Main dashboard
â”‚   â”‚   â”‚   â”œâ”€â”€ MapScreen.js              # Interactive property map
â”‚   â”‚   â”‚   â”œâ”€â”€ PropertyDetailScreen.js   # Property details view
â”‚   â”‚   â”œâ”€â”€ services/                     # External service integrations
â”‚   â”‚   â”‚   â”œâ”€â”€ GeocodingService.js       # Google Maps geocoding
â”‚   â”‚   â”‚   â”œâ”€â”€ CloudinaryService.js      # Image upload service
â”‚   â”‚   â”‚   â””â”€â”€ APIService.js             # Backend API communication
â”‚   â”‚   â”œâ”€â”€ config/                       # Configuration files
â”‚   â”‚   â”‚   â””â”€â”€ env.js                    # Environment variables
â”‚   â”‚   â”œâ”€â”€ utils/                        # Utility functions
â”‚   â”‚   â”‚   â”œâ”€â”€ constants.js              # App constants
â”‚   â”‚   â”‚   â”œâ”€â”€ helpers.js                # Helper functions
â”‚   â”‚   â”‚   â””â”€â”€ validation.js             # Form validation
â”‚   â”‚   â”œâ”€â”€ assets/                       # Static assets
â”‚   â”‚   â”‚   â”œâ”€â”€ images/                   # App images and icons
â”‚   â”‚   â”‚   â””â”€â”€ fonts/                    # Custom fonts
â”‚   â”‚   â””â”€â”€ navigation/                   # Navigation configuration
â”‚   â”‚       â”œâ”€â”€ AppNavigator.js           # Main navigation structure
â”‚   â”‚       â””â”€â”€ TabNavigator.js           # Tab-based navigation
â”‚   â”œâ”€â”€ android/                          # Android-specific configuration
â”‚   â”œâ”€â”€ ios/                              # iOS-specific configuration
â”‚   â””â”€â”€ node_modules/                     # Node.js dependencies
â”œâ”€â”€ .gitignore                            # Git ignore patterns
â”œâ”€â”€ .env.example                          # Environment variables template
â””â”€â”€ docs/                                 # Additional documentation
    â”œâ”€â”€ api/                              # API documentation
    â”œâ”€â”€ deployment/                       # Deployment guides
    â””â”€â”€ troubleshooting/                  # Common issues and solutions
```

## ğŸ”„ DEVELOPMENT WORKFLOW

### 1. Feature Development
- **Backend First**: Implement Django models, views, and serializers
- **API Testing**: Verify endpoints with curl or Postman
- **Frontend Integration**: Update React Native components and context
- **Testing**: Test on physical device, not just simulator

### 2. Code Review Checklist
- [ ] No hardcoded values (use environment variables)
- [ ] Proper error handling and logging
- [ ] API endpoints documented and tested
- [ ] Mobile app functionality verified
- [ ] Database migrations tested locally

### 3. Deployment Process
- [ ] Code committed and pushed to main branch
- [ ] Backend automatically deploys on Render
- [ ] Environment variables verified in Render dashboard
- [ ] API endpoints tested on production
- [ ] Mobile app tested with production backend

---

## ğŸ¯ REMEMBER: This is a PRODUCTION-READY Ethiopian real estate app. 
## Every line of code must work in production, handle errors gracefully, 
## and provide a seamless user experience for property buyers, sellers, and agents.
